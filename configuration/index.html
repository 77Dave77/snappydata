<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="SnappyData Development Team">
  
  <title>Configuring the Cluster - SnappyData Documentation</title>
  

  <link rel="shortcut icon" href="../favicon.ico">
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  <link href="../extra.css" rel="stylesheet">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Configuring the Cluster";
    var mkdocs_page_input_path = "configuration.md";
    var mkdocs_page_url = "/configuration/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script>
  <script src="../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> SnappyData Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="..">Overview</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../quickstart/">Getting Started</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../install/">Download and Install</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../howto/">How Tos</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../architecture/">Architecture</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 current">
        <a class="current" href="./">Configuring the Cluster</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#overview">Overview</a></li>
                
                    <li><a class="toctree-l4" href="#configuration-files">Configuration Files</a></li>
                
                    <li><a class="toctree-l4" href="#hdfs-with-snappydata-store">HDFS with SnappyData Store</a></li>
                
                    <li><a class="toctree-l4" href="#spark-specific-properties">Spark Specific Properties</a></li>
                
                    <li><a class="toctree-l4" href="#example-for-multiple-host-configuration">Example for Multiple-Host Configuration</a></li>
                
                    <li><a class="toctree-l4" href="#environment-settings">Environment Settings</a></li>
                
                    <li><a class="toctree-l4" href="#hadoop-provided-settings">Hadoop Provided Settings</a></li>
                
                    <li><a class="toctree-l4" href="#per-component-configuration">Per Component Configuration</a></li>
                
                    <li><a class="toctree-l4" href="#snappy-shell-command-line-utility">snappy-shell Command Line Utility</a></li>
                
                    <li><a class="toctree-l4" href="#logging">Logging</a></li>
                
                    <li><a class="toctree-l4" href="#configuring-ssh-login-without-password">Configuring SSH Login without Password</a></li>
                
            
            </ul>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../programming_guide/">Programming Guide</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../deployment/">Affinity Modes</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../aqp/">Synopsis Data Engine (SDE)</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../aqp_aws/">Using iSight-Cloud</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../apidocsintro/">API</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>About</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../techsupport/">Contact and Support</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../LICENSE/">License</a>
        
    </li>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">SnappyData Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Configuring the Cluster</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="https://github.com/SnappyDataInc/snappydata" class="icon icon-github"> Edit on GitHub</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="overview">Overview</h1>
<p>SnappyData, a database server cluster, has three main components - Locator, Server and Lead. </p>
<p>The Lead node embeds a Spark driver and the Server node embeds a Spark Executor. The server node also embeds a SnappyData store.</p>
<p>SnappyData cluster can be started with the default configurations using script <code>sbin/snappy-start-all.sh</code>. This script starts up a locator, one data server, and one lead node. However, SnappyData can be configured to start multiple components on different nodes. 
Also, each component can be configured individually using configuration files. In this document, 
we discuss how the components can be individually configured. We also discuss various other configurations of SnappyData.</p>
<h2 id="configuration-files">Configuration Files</h2>
<p>Configuration files for locator, lead, and server should be created in SNAPPY_HOME with names as <strong>conf/locators</strong>, <strong>conf/leads</strong> and <strong>conf/servers</strong> respectively. These files contain the hostnames of the nodes (one per line) where you intend to start the member. You can specify the properties to configure individual members.</p>
<h4 id="configuring-locators">Configuring Locators</h4>
<p>Locators provide discovery service for the cluster. It informs a new member joining the group about other existing members. A cluster usually has more than one locator for high availability reasons.</p>
<p>In this file, you can specify:</p>
<ul>
<li>
<p>The host name on which a SnappyData locator is started</p>
</li>
<li>
<p>The startup directory where the logs and configuration files for that locator instance are located</p>
</li>
<li>
<p>SnappyData specific properties that can be passed</p>
</li>
</ul>
<p>Create the configuration files (conf/locators) for locators in <code>SNAPPY_HOME</code>.</p>
<h4 id="configuring-leads">Configuring Leads</h4>
<p>Lead Nodes act as a Spark driver by maintaining a singleton SparkContext. There is one primary lead node at any given instance, but there can be multiple secondary lead node instances on standby for fault tolerance. The lead node hosts a REST server to accept and run applications. The lead node also executes SQL queries routed to it by “data server” members.</p>
<p>Create the configuration files (conf/leads) for leads in <code>SNAPPY_HOME</code>.</p>
<h4 id="configuring-data-servers">Configuring Data Servers</h4>
<p>Data Servers hosts data, embeds a Spark executor, and also contains a SQL engine capable of executing certain queries independently and more efficiently than Spark. Data servers use intelligent query routing to either execute the query directly on the node or to pass it to the lead node for execution by Spark SQL.</p>
<p>Create the configuration files (conf/servers) for data servers in <code>SNAPPY_HOME</code>.</p>
<h4 id="snappydata-specific-properties">SnappyData Specific Properties</h4>
<p>The following are the few important SnappyData properties that you can configure:</p>
<ul>
<li>
<p><strong>-peer-discovery-port</strong>: This is a locator specific property. This is the port on which locator listens for member discovery. It defaults to 10334. </p>
</li>
<li>
<p><strong>-client-port</strong>: Port that a member listens on for client connections. </p>
</li>
<li>
<p><strong>-locators</strong>: List of other locators as comma-separated host:port values. For locators, the list must include all other locators in use. For Servers and Leads, the list must include all the locators of the distributed system.</p>
</li>
<li>
<p><strong>-dir</strong>: SnappyData members need to have the working directory. The member working directory provides a default location for the log file, persistence, and status files for each member.<br> If not specified, SnappyData creates the member directory in <em>SNAPPY_HOME\work</em>. </p>
</li>
<li>
<p><strong>-classpath</strong>: This can be used to provide any application specific code to the lead and servers. We envisage having setJar like functionality going forward but for now, the application jars have to be provided during startup. </p>
</li>
<li>
<p><strong>-heap-size</strong>: Set a fixed heap size and for the Java VM. </p>
</li>
<li>
<p><strong>-J</strong>: Use this to configure any JVM specific property. For example. -J-XX:MaxPermSize=512m. </p>
</li>
</ul>
<p>For a detailed list of SnappyData configurations for Leads and Servers, you can consult <a href="http://gemfirexd.docs.pivotal.io/docs-gemfirexd/reference/gfxd_commands/gfxd-server.html">this</a>. For a detailed list of SnappyData configurations for Locators, you can consult <a href="http://gemfirexd.docs.pivotal.io/docs-gemfirexd/reference/gfxd_commands/gfxd-locator.html">this</a>.</p>
<h2 id="hdfs-with-snappydata-store">HDFS with SnappyData Store</h2>
<p>If using SnappyData store persistence to Hadoop as documented <a href="http://gemfirexd.docs.pivotal.io/docs-gemfirexd/disk_storage/persist-hdfs.html">here</a>, then add the <a href="http://search.maven.org/#artifactdetails|org.apache.hbase|hbase|0.94.27|jar">hbase jar</a> explicitly to CLASSPATH. The jar is now packed in the product tree, so that can be used or download from Apache Maven. Then add to conf/spark-env.sh:</p>
<p><code>export SPARK_DIST_CLASSPATH=&lt;/path/to/&gt;hbase-0.94.27.jar</code></p>
<p>Substitute the actual path for <code>&lt;/path/to/&gt;</code> above</p>
<h2 id="spark-specific-properties">Spark Specific Properties</h2>
<p>Since SnappyData embeds Spark components, <a href="http://spark.apache.org/docs/latest/configuration.html#runtime-environment">Spark Runtime environment properties</a> (like  spark.driver.memory, spark.executor.memory, spark.driver.extraJavaOptions, spark.executorEnv) do not take effect. They have to be specified using SnappyData configuration properties. </p>
<p>Apart from these properties, other Spark properties can be specified in the configuration file of the Lead nodes. You have to prefix them with a <em>hyphen(-)</em>. The Spark properties that are specified on the Lead node are sent to the Server nodes. Any Spark property that is specified in the conf/servers or conf/locators file is ignored. </p>
<p><Note>Note: Currently we do not honor properties specified using spark-config.sh. </Note></p>
<h2 id="example-for-multiple-host-configuration">Example for Multiple-Host Configuration</h2>
<p>Let's say you want to:</p>
<ul>
<li>
<p>Start two Locators (on node-a:9999 and node-b:8888), two servers (node-c and node-c) and a lead (node-l).</p>
</li>
<li>
<p>Change the Spark UI port from 4040 to 9090. </p>
</li>
<li>
<p>Set spark.executor.cores as 10 on all servers. </p>
</li>
</ul>
<p>The following can be your conf files. </p>
<pre><code class="bash">$ cat conf/locators
node-a -peer-discovery-port=9999 -dir=/node-a/locator1 -heap-size=1024m -locators=node-b:8888
node-b -peer-discovery-port=8888 -dir=/node-b/locator2 -heap-size=1024m -locators=node-a:9999

$ cat conf/servers
node-c -dir=/node-c/server1 -heap-size=4096m -locators=node-b:8888,node-a:9999
node-c -dir=/node-c/server2 -heap-size=4096m -locators=node-b:8888,node-a:9999

$ cat conf/leads
# This goes to the default directory 
node-l -heap-size=4096m -J-XX:MaxPermSize=512m -spark.ui.port=9090 -locators=node-b:8888,node-a:9999 -spark.executor.cores=10
</code></pre>

<p><Note> Note: Conf files are consulted when servers are started and also when they are stopped. So, we do not recommend changing the conf files while the cluster is running. </Note></p>
<h2 id="environment-settings">Environment Settings</h2>
<p>Any Spark or SnappyData specific environment settings can be done by creating a snappy-env.sh or spark-env.sh in <em>SNAPPY_HOME/conf</em>. </p>
<h2 id="hadoop-provided-settings">Hadoop Provided Settings</h2>
<p>If you want to run SnappyData with an already existing custom Hadoop cluster like MapR or Cloudera you should download Snappy without Hadoop from the download link.
This allows you to provide Hadoop at runtime.</p>
<p>To do this you need to put an entry in $SNAPPY-HOME/conf/spark-env.sh as below:</p>
<pre><code>export SPARK_DIST_CLASSPATH=$($OTHER_HADOOP_HOME/bin/hadoop classpath)
</code></pre>

<h2 id="per-component-configuration">Per Component Configuration</h2>
<p>Most of the time, components would be sharing the same properties. For example, you would want all servers to start with 4096m while leads to start with 2048m. You can configure these by specifying LOCATOR_STARTUP_OPTIONS, SERVER_STARTUP_OPTIONS, LEAD_STARTUP_OPTIONS environment variables in conf/snappy-env.sh. </p>
<pre><code class="bash">$ cat conf/snappy-env.sh
SERVER_STARTUP_OPTIONS=&quot;-heap-size=4096m&quot;
LEAD_STARTUP_OPTIONS=&quot;-heap-size=2048m&quot;
</code></pre>

<h2 id="snappy-shell-command-line-utility">snappy-shell Command Line Utility</h2>
<p>Instead of starting SnappyData members using SSH scripts, they can be individually configured and started using command line. </p>
<pre><code class="bash">$ bin/snappy-shell locator start  -dir=/node-a/locator1 
$ bin/snappy-shell server start  -dir=/node-b/server1  -locators:localhost:10334

$ bin/snappy-shell locator stop
$ bin/snappy-shell server stop
</code></pre>

<h2 id="logging">Logging</h2>
<p>Currently, log files for SnappyData components go inside the working directory. To change the log file directory, you can specify a property <em>-log-file</em> as the path of the directory. There is a log4j.properties file that is shipped with the jar. We recommend not to change it at this moment. However, to change the logging levels, you can create a conf/log4j.properties with the following details: </p>
<pre><code class="bash">$ cat conf/log4j.properties 
log4j.rootCategory=DEBUG, file
</code></pre>

<h2 id="configuring-ssh-login-without-password">Configuring SSH Login without Password</h2>
<p>By default, Secure Socket Shell (SSH) requires a password for authentication on a remote server.
This setting needs to be modified to allow you to login to the remote host through the SSH protocol, without having to enter your SSH password multiple times when working with SnappyData.</p>
<p>To install and configure SSH, do the following:</p>
<ol>
<li>
<p><strong>Install SSH</strong> <br>
    To install SSH,  type:
    <code>sudo apt-get install ssh</code>
    Mac OS X has a built-in SSH client.</p>
</li>
<li>
<p><strong>Generate an RSA key pair</strong><br>
    To generate an RSA key pair run the following command on the client computer,
    <code>ssh-keygen -t rsa</code>
    Press <strong>Enter</strong> when prompted to enter file in which to save the key, and for the pass phrase.</p>
</li>
<li>
<p><strong>Copy the Public Key</strong><br>
    Once the key pair is generated, copy the contents of the public key file, to the authorized key on the remote site, by typing <code>cat ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys</code></p>
</li>
</ol>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../programming_guide/" class="btn btn-neutral float-right" title="Programming Guide">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../architecture/" class="btn btn-neutral" title="Architecture"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright &copy; 2016 SnappyData Inc.</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/SnappyDataInc/snappydata" class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../architecture/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../programming_guide/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
